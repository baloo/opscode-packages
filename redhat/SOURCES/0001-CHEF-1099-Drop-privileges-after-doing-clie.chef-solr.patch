From 1bd70d5eea5ba4d427d50c15c1376c7ac52d478a Mon Sep 17 00:00:00 2001
From: Matthew Kent <mkent@magoazul.com>
Date: Mon, 5 Apr 2010 00:19:06 -0700
Subject: [PATCH 1/2] CHEF-1099: Drop privileges after doing client setup, which includes reading
 client.pem which is owned by root.

---
 lib/chef/solr/application/solr.rb |    4 ++--
 1 files changed, 2 insertions(+), 2 deletions(-)

diff --git a/lib/chef/solr/application/solr.rb b/lib/chef/solr/application/solr.rb
index 8042c76..fb1fe3e 100644
--- a/lib/chef/solr/application/solr.rb
+++ b/lib/chef/solr/application/solr.rb
@@ -118,12 +118,12 @@ class Chef
         end
 
         def setup_application
-          Chef::Daemon.change_privilege
-
           # Build up a client
           c = Chef::Client.new
           c.build_node(nil, true)
 
+          Chef::Daemon.change_privilege
+
           solr_base = File.expand_path(File.join(File.dirname(__FILE__), "..", "..", "..", "..", "solr"))
 
           # Create the Jetty container
-- 
1.6.3.3

